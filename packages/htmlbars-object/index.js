import { Meta, MetaBuilder, ComputedBlueprint, intern } from 'htmlbars-reference';
export default class HTMLBarsObject {
    static extend(object) {
        let builder = new MetaBuilder();
        let Class = class class_1 {
            constructor(attrs) {
                Object.assign(this, attrs);
            }
        }
        ;
        Object.keys(object).forEach(key => {
            object[key].define(Class.prototype, key);
            object[key].addReferenceType(builder, key);
        });
        Class._Meta = builder.seal();
        return Class;
    }
}
class Computed {
    constructor(callback, deps) {
        this._callback = callback;
        this._deps = deps.map(d => d.split('.').map(intern));
    }
    define(prototype, key) {
        Object.defineProperty(prototype, key, {
            enumerable: true,
            configurable: true,
            get: this._callback
        });
    }
    addReferenceType(builder, key) {
        /*jshint -W064*/
        builder.addReferenceTypeFor(key, ComputedBlueprint(key, this._deps)); /*jshint +W064*/
    }
}
export function computed(callback, ...deps) {
    return new Computed(callback, deps);
}
export function setProperty(parent, property, val) {
    var rootProp = Meta.for(parent).root()._chains[property];
    var referencesToNotify = Meta.for(parent).referencesFor(property);
    parent[property] = val;
    if (referencesToNotify) {
        referencesToNotify.forEach(function (ref) { ref._reparent(); });
    }
    if (rootProp)
        rootProp.notify();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvaHRtbGJhcnMtb2JqZWN0L2luZGV4LnRzIl0sIm5hbWVzIjpbIkhUTUxCYXJzT2JqZWN0IiwiSFRNTEJhcnNPYmplY3QuZXh0ZW5kIiwiSFRNTEJhcnNPYmplY3QuZXh0ZW5kLmNvbnN0cnVjdG9yIiwiQ29tcHV0ZWQiLCJDb21wdXRlZC5jb25zdHJ1Y3RvciIsIkNvbXB1dGVkLmRlZmluZSIsIkNvbXB1dGVkLmFkZFJlZmVyZW5jZVR5cGUiLCJjb21wdXRlZCIsInNldFByb3BlcnR5Il0sIm1hcHBpbmdzIjoiT0FBTyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxFQUFFLE1BQU0sb0JBQW9CO0FBRWpGO0lBQ0VBLE9BQU9BLE1BQU1BLENBQUNBLE1BQU1BO1FBQ2xCQyxJQUFJQSxPQUFPQSxHQUFHQSxJQUFJQSxXQUFXQSxFQUFFQSxDQUFDQTtRQUVoQ0EsSUFBSUEsS0FBS0EsR0FBR0E7WUFDVkEsWUFBWUEsS0FBS0E7Z0JBQ2ZDLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLEVBQUVBLEtBQUtBLENBQUNBLENBQUNBO1lBQzdCQSxDQUFDQTtRQUNIRCxDQUFDQTtRQUFBQSxDQUFDQTtRQUVGQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxHQUFHQTtZQUM3QkEsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsU0FBU0EsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDekNBLE1BQU1BLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsT0FBT0EsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDN0NBLENBQUNBLENBQUNBLENBQUNBO1FBRUhBLEtBQUtBLENBQUNBLEtBQUtBLEdBQUdBLE9BQU9BLENBQUNBLElBQUlBLEVBQUVBLENBQUNBO1FBQzdCQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQTtJQUNmQSxDQUFDQTtBQUNIRCxDQUFDQTtBQUVEO0lBQ0VHLFlBQVlBLFFBQVFBLEVBQUVBLElBQUlBO1FBQ3hCQyxJQUFJQSxDQUFDQSxTQUFTQSxHQUFHQSxRQUFRQSxDQUFDQTtRQUMxQkEsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUFDdkRBLENBQUNBO0lBRURELE1BQU1BLENBQUNBLFNBQVNBLEVBQUVBLEdBQUdBO1FBQ25CRSxNQUFNQSxDQUFDQSxjQUFjQSxDQUFDQSxTQUFTQSxFQUFFQSxHQUFHQSxFQUFFQTtZQUNwQ0EsVUFBVUEsRUFBRUEsSUFBSUE7WUFDaEJBLFlBQVlBLEVBQUVBLElBQUlBO1lBQ2xCQSxHQUFHQSxFQUFFQSxJQUFJQSxDQUFDQSxTQUFTQTtTQUNwQkEsQ0FBQ0EsQ0FBQ0E7SUFDTEEsQ0FBQ0E7SUFFREYsZ0JBQWdCQSxDQUFDQSxPQUFPQSxFQUFFQSxHQUFHQTtRQUMzQkcsZ0JBQWdCQTtRQUNoQkEsT0FBT0EsQ0FBQ0EsbUJBQW1CQSxDQUFDQSxHQUFHQSxFQUFFQSxpQkFBaUJBLENBQUNBLEdBQUdBLEVBQUVBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLGdCQUFnQkE7SUFDeEZBLENBQUNBO0FBQ0hILENBQUNBO0FBRUQseUJBQXlCLFFBQVEsRUFBRSxHQUFHLElBQUk7SUFDeENJLE1BQU1BLENBQUNBLElBQUlBLFFBQVFBLENBQUNBLFFBQVFBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO0FBQ3RDQSxDQUFDQTtBQUVELDRCQUE0QixNQUFNLEVBQUUsUUFBUSxFQUFFLEdBQUc7SUFDL0NDLElBQUlBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLElBQUlBLEVBQUVBLENBQUNBLE9BQU9BLENBQUNBLFFBQVFBLENBQUNBLENBQUNBO0lBRXpEQSxJQUFJQSxrQkFBa0JBLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLGFBQWFBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBO0lBRWxFQSxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQTtJQUV2QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN2QkEsa0JBQWtCQSxDQUFDQSxPQUFPQSxDQUFDQSxVQUFTQSxHQUFHQSxJQUFJLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQ0EsQ0FBQ0E7SUFDakVBLENBQUNBO0lBRURBLEVBQUVBLENBQUNBLENBQUNBLFFBQVFBLENBQUNBO1FBQUNBLFFBQVFBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBO0FBQ2xDQSxDQUFDQSJ9