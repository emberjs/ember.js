import { JitRenderDelegate } from '../modes/jit/delegate';
import { keys } from '@glimmer/util';
import { AotRenderDelegate } from '../modes/aot/delegate';
import { NodeRenderDelegate } from '../modes/node/env';
import { JitSerializationDelegate, AotSerializationDelegate } from '../suites/custom-dom-helper';
export function jitSuite(klass, options = { componentModule: false }) {
    return suite(klass, JitRenderDelegate, options);
}
export function nodeSuite(klass, options = { componentModule: false }) {
    return suite(klass, NodeRenderDelegate, options);
}
export function nodeComponentSuite(klass) {
    return suite(klass, NodeRenderDelegate, { componentModule: true });
}
export function jitComponentSuite(klass) {
    return suite(klass, JitRenderDelegate, { componentModule: true });
}
export function aotSuite(klass, options = { componentModule: false }) {
    return suite(klass, AotRenderDelegate, options);
}
export function aotComponentSuite(klass) {
    return suite(klass, AotRenderDelegate, { componentModule: true });
}
export function jitSerializeSuite(klass, options = { componentModule: false }) {
    return suite(klass, JitSerializationDelegate, options);
}
export function aotSerializeSuite(klass, options = { componentModule: false }) {
    return suite(klass, AotSerializationDelegate, options);
}
export function componentSuite(klass, Delegate) {
    return suite(klass, Delegate, { componentModule: true });
}
export function suite(klass, Delegate, options = { componentModule: false }) {
    let suiteName = klass.suiteName;
    if (options.componentModule) {
        if (shouldRunTest(Delegate)) {
            componentModule(`${Delegate.style} :: Components :: ${suiteName}`, klass, Delegate);
        }
    }
    else {
        QUnit.module(`[integration] ${Delegate.style} :: ${suiteName}`);
        for (let prop in klass.prototype) {
            const test = klass.prototype[prop];
            if (isTestFunction(test) && shouldRunTest(Delegate)) {
                QUnit.test(prop, assert => {
                    let instance = new klass(new Delegate());
                    test.call(instance, assert, instance.count);
                    instance.count.assert();
                });
            }
        }
    }
}
function componentModule(name, klass, Delegate) {
    let tests = {
        glimmer: [],
        curly: [],
        dynamic: [],
        basic: [],
        fragment: [],
    };
    function createTest(prop, test, skip) {
        let shouldSkip;
        if (skip === true || test.skip === true) {
            shouldSkip = true;
        }
        return (type, klass) => {
            if (!shouldSkip) {
                QUnit.test(prop, assert => {
                    let instance = new klass(new Delegate());
                    instance.testType = type;
                    test.call(instance, assert, instance.count);
                });
            }
        };
    }
    for (let prop in klass.prototype) {
        const test = klass.prototype[prop];
        if (isTestFunction(test)) {
            if (test['kind'] === undefined) {
                let skip = test['skip'];
                switch (skip) {
                    case 'glimmer':
                        tests.curly.push(createTest(prop, test));
                        tests.dynamic.push(createTest(prop, test));
                        tests.glimmer.push(createTest(prop, test, true));
                        break;
                    case 'curly':
                        tests.glimmer.push(createTest(prop, test));
                        tests.dynamic.push(createTest(prop, test));
                        tests.curly.push(createTest(prop, test, true));
                        break;
                    case 'dynamic':
                        tests.glimmer.push(createTest(prop, test));
                        tests.curly.push(createTest(prop, test));
                        tests.dynamic.push(createTest(prop, test, true));
                        break;
                    case true:
                        if (test['kind'] === 'basic') {
                            // Basic components are not part of matrix testing
                            tests.basic.push(createTest(prop, test, true));
                        }
                        else if (test['kind'] === 'fragment') {
                            tests.fragment.push(createTest(prop, test, true));
                        }
                        else {
                            ['glimmer', 'curly', 'dynamic'].forEach(kind => {
                                tests[kind].push(createTest(prop, test, true));
                            });
                        }
                    default:
                        tests.glimmer.push(createTest(prop, test));
                        tests.curly.push(createTest(prop, test));
                        tests.dynamic.push(createTest(prop, test));
                }
                continue;
            }
            let kind = test['kind'];
            if (kind === 'curly') {
                tests.curly.push(createTest(prop, test));
                tests.dynamic.push(createTest(prop, test));
            }
            if (kind === 'glimmer') {
                tests.glimmer.push(createTest(prop, test));
            }
            if (kind === 'dynamic') {
                tests.curly.push(createTest(prop, test));
                tests.dynamic.push(createTest(prop, test));
            }
            if (kind === 'basic') {
                tests.basic.push(createTest(prop, test));
            }
            if (kind === 'fragment') {
                tests.fragment.push(createTest(prop, test));
            }
        }
    }
    QUnit.module(`[integration] ${name}`, () => {
        nestedComponentModules(klass, tests);
    });
}
function nestedComponentModules(klass, tests) {
    keys(tests).forEach(type => {
        let formattedType = `${type[0].toUpperCase() + type.slice(1)}`;
        QUnit.module(`[integration] ${formattedType}`, () => {
            for (let i = tests[type].length - 1; i >= 0; i--) {
                let t = tests[type][i];
                t(formattedType, klass);
                tests[type].pop();
            }
        });
    });
}
const HAS_TYPED_ARRAYS = typeof Uint16Array !== 'undefined';
function shouldRunTest(Delegate) {
    let isEagerDelegate = Delegate['isEager'];
    if (HAS_TYPED_ARRAYS) {
        return true;
    }
    if (!HAS_TYPED_ARRAYS && !isEagerDelegate) {
        return true;
    }
    return false;
}
function isTestFunction(value) {
    return typeof value === 'function' && value.isTest;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kdWxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL3Rlc3QtaGVscGVycy9tb2R1bGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFFMUQsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUdyQyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQU9qRyxNQUFNLFVBQVUsUUFBUSxDQUN0QixLQUErQyxFQUMvQyxPQUFPLEdBQUcsRUFBRSxlQUFlLEVBQUUsS0FBSyxFQUFFO0lBRXBDLE9BQU8sS0FBSyxDQUFDLEtBQUssRUFBRSxpQkFBaUIsRUFBRSxPQUFPLENBQUMsQ0FBQztBQUNsRCxDQUFDO0FBRUQsTUFBTSxVQUFVLFNBQVMsQ0FDdkIsS0FBK0MsRUFDL0MsT0FBTyxHQUFHLEVBQUUsZUFBZSxFQUFFLEtBQUssRUFBRTtJQUVwQyxPQUFPLEtBQUssQ0FBQyxLQUFLLEVBQUUsa0JBQWtCLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFDbkQsQ0FBQztBQUVELE1BQU0sVUFBVSxrQkFBa0IsQ0FDaEMsS0FBK0M7SUFFL0MsT0FBTyxLQUFLLENBQUMsS0FBSyxFQUFFLGtCQUFrQixFQUFFLEVBQUUsZUFBZSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7QUFDckUsQ0FBQztBQUVELE1BQU0sVUFBVSxpQkFBaUIsQ0FDL0IsS0FBK0M7SUFFL0MsT0FBTyxLQUFLLENBQUMsS0FBSyxFQUFFLGlCQUFpQixFQUFFLEVBQUUsZUFBZSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7QUFDcEUsQ0FBQztBQUVELE1BQU0sVUFBVSxR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QUM7YUFDbkI7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQUVELE1BQU0sZ0JBQWdCLEdBQUcsT0FBTyxXQUFXLEtBQUssV0FBVyxDQUFDO0FBRTVELFNBQVMsYUFBYSxDQUEyQixRQUFzQztJQUNyRixJQUFJLGVBQWUsR0FBRyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUM7SUFFMUMsSUFBSSxnQkFBZ0IsRUFBRTtRQUNwQixPQUFPLElBQUksQ0FBQztLQUNiO0lBRUQsSUFBSSxDQUFDLGdCQUFnQixJQUFJLENBQUMsZUFBZSxFQUFFO1FBQ3pDLE9BQU8sSUFBSSxDQUFDO0tBQ2I7SUFFRCxPQUFPLEtBQUssQ0FBQztBQUNmLENBQUM7QUFRRCxTQUFTLGNBQWMsQ0FBQyxLQUFVO0lBQ2hDLE9BQU8sT0FBTyxLQUFLLEtBQUssVUFBVSxJQUFJLEtBQUssQ0FBQyxNQUFNLENBQUM7QUFDckQsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElSZW5kZXJUZXN0LCBDb3VudCwgUmVuZGVyVGVzdCB9IGZyb20gJy4uL3JlbmRlci10ZXN0JztcbmltcG9ydCBSZW5kZXJEZWxlZ2F0ZSBmcm9tICcuLi9yZW5kZXItZGVsZWdhdGUnO1xuaW1wb3J0IHsgSml0UmVuZGVyRGVsZWdhdGUgfSBmcm9tICcuLi9tb2Rlcy9qaXQvZGVsZWdhdGUnO1xuaW1wb3J0IHsgU2ltcGxlRG9jdW1lbnQgfSBmcm9tICdAc2ltcGxlLWRvbS9pbnRlcmZhY2UnO1xuaW1wb3J0IHsga2V5cyB9IGZyb20gJ0BnbGltbWVyL3V0aWwnO1xuaW1wb3J0IHsgRGVjbGFyZWRDb21wb25lbnRLaW5kIH0gZnJvbSAnLi4vdGVzdC1kZWNvcmF0b3InO1xuaW1wb3J0IHsgQ29tcG9uZW50S2luZCB9IGZyb20gJy4uL2NvbXBvbmVudHMnO1xuaW1wb3J0IHsgQW90UmVuZGVyRGVsZWdhdGUgfSBmcm9tICcuLi9tb2Rlcy9hb3QvZGVsZWdhdGUnO1xuaW1wb3J0IHsgTm9kZVJlbmRlckRlbGVnYXRlIH0gZnJvbSAnLi4vbW9kZXMvbm9kZS9lbnYnO1xuaW1wb3J0IHsgSml0U2VyaWFsaXphdGlvbkRlbGVnYXRlLCBBb3RTZXJpYWxpemF0aW9uRGVsZWdhdGUgfSBmcm9tICcuLi9zdWl0ZXMvY3VzdG9tLWRvbS1oZWxwZXInO1xuXG5leHBvcnQgaW50ZXJmYWNlIFJlbmRlclRlc3RDb25zdHJ1Y3RvcjxEIGV4dGVuZHMgUmVuZGVyRGVsZWdhdGUsIFQgZXh0ZW5kcyBJUmVuZGVyVGVzdD4ge1xuICBzdWl0ZU5hbWU6IHN0cmluZztcbiAgbmV3IChkZWxlZ2F0ZTogRCk6IFQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBqaXRTdWl0ZTxUIGV4dGVuZHMgSVJlbmRlclRlc3Q+KFxuICBrbGFzczogUmVuZGVyVGVzdENvbnN0cnVjdG9yPFJlbmRlckRlbGVnYXRlLCBUPixcbiAgb3B0aW9ucyA9IHsgY29tcG9uZW50TW9kdWxlOiBmYWxzZSB9XG4pOiB2b2lkIHtcbiAgcmV0dXJuIHN1aXRlKGtsYXNzLCBKaXRSZW5kZXJEZWxlZ2F0ZSwgb3B0aW9ucyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBub2RlU3VpdGU8VCBleHRlbmRzIElSZW5kZXJUZXN0PihcbiAga2xhc3M6IFJlbmRlclRlc3RDb25zdHJ1Y3RvcjxSZW5kZXJEZWxlZ2F0ZSwgVD4sXG4gIG9wdGlvbnMgPSB7IGNvbXBvbmVudE1vZHVsZTogZmFsc2UgfVxuKTogdm9pZCB7XG4gIHJldHVybiBzdWl0ZShrbGFzcywgTm9kZVJlbmRlckRlbGVnYXRlLCBvcHRpb25zKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5vZGVDb21wb25lbnRTdWl0ZTxUIGV4dGVuZHMgSVJlbmRlclRlc3Q+KFxuICBrbGFzczogUmVuZGVyVGVzdENvbnN0cnVjdG9yPFJlbmRlckRlbGVnYXRlLCBUPlxuKTogdm9pZCB7XG4gIHJldHVybiBzdWl0ZShrbGFzcywgTm9kZVJlbmRlckRlbGVnYXRlLCB7IGNvbXBvbmVudE1vZHVsZTogdHJ1ZSB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGppdENvbXBvbmVudFN1aXRlPFQgZXh0ZW5kcyBJUmVuZGVyVGVzdD4oXG4gIGtsYXNzOiBSZW5kZXJUZXN0Q29uc3RydWN0b3I8UmVuZGVyRGVsZWdhdGUsIFQ+XG4pOiB2b2lkIHtcbiAgcmV0dXJuIHN1aXRlKGtsYXNzLCBKaXRSZW5kZXJEZWxlZ2F0ZSwgeyBjb21wb25lbnRNb2R1bGU6IHRydWUgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhb3RTdWl0ZTxUIGV4dGVuZHMgSVJlbmRlclRlc3Q+KFxuICBrbGFzczogUmVuZGVyVGVzdENvbnN0cnVjdG9yPFJlbmRlckRlbGVnYXRlLCBUPixcbiAgb3B0aW9ucyA9IHsgY29tcG9uZW50TW9kdWxlOiBmYWxzZSB9XG4pOiB2b2lkIHtcbiAgcmV0dXJuIHN1aXRlKGtsYXNzLCBBb3RSZW5kZXJEZWxlZ2F0ZSwgb3B0aW9ucyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhb3RDb21wb25lbnRTdWl0ZTxUIGV4dGVuZHMgSVJlbmRlclRlc3Q+KFxuICBrbGFzczogUmVuZGVyVGVzdENvbnN0cnVjdG9yPFJlbmRlckRlbGVnYXRlLCBUPlxuKTogdm9pZCB7XG4gIHJldHVybiBzdWl0ZShrbGFzcywgQW90UmVuZGVyRGVsZWdhdGUsIHsgY29tcG9uZW50TW9kdWxlOiB0cnVlIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaml0U2VyaWFsaXplU3VpdGU8VCBleHRlbmRzIElSZW5kZXJUZXN0PihcbiAga2xhc3M6IFJlbmRlclRlc3RDb25zdHJ1Y3RvcjxSZW5kZXJEZWxlZ2F0ZSwgVD4sXG4gIG9wdGlvbnMgPSB7IGNvbXBvbmVudE1vZHVsZTogZmFsc2UgfVxuKTogdm9pZCB7XG4gIHJldHVybiBzdWl0ZShrbGFzcywgSml0U2VyaWFsaXphdGlvbkRlbGVnYXRlLCBvcHRpb25zKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFvdFNlcmlhbGl6ZVN1aXRlPFQgZXh0ZW5kcyBJUmVuZGVyVGVzdD4oXG4gIGtsYXNzOiBSZW5kZXJUZXN0Q29uc3RydWN0b3I8UmVuZGVyRGVsZWdhdGUsIFQ+LFxuICBvcHRpb25zID0geyBjb21wb25lbnRNb2R1bGU6IGZhbHNlIH1cbik6IHZvaWQge1xuICByZXR1cm4gc3VpdGUoa2xhc3MsIEFvdFNlcmlhbGl6YXRpb25EZWxlZ2F0ZSwgb3B0aW9ucyk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVuZGVyRGVsZWdhdGVDb25zdHJ1Y3RvcjxEZWxlZ2F0ZSBleHRlbmRzIFJlbmRlckRlbGVnYXRlPiB7XG4gIHJlYWRvbmx5IGlzRWFnZXI6IGJvb2xlYW47XG4gIHJlYWRvbmx5IHN0eWxlOiBzdHJpbmc7XG4gIG5ldyAoZG9jPzogU2ltcGxlRG9jdW1lbnQpOiBEZWxlZ2F0ZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBvbmVudFN1aXRlPEQgZXh0ZW5kcyBSZW5kZXJEZWxlZ2F0ZT4oXG4gIGtsYXNzOiBSZW5kZXJUZXN0Q29uc3RydWN0b3I8RCwgSVJlbmRlclRlc3Q+LFxuICBEZWxlZ2F0ZTogUmVuZGVyRGVsZWdhdGVDb25zdHJ1Y3RvcjxEPlxuKTogdm9pZCB7XG4gIHJldHVybiBzdWl0ZShrbGFzcywgRGVsZWdhdGUsIHsgY29tcG9uZW50TW9kdWxlOiB0cnVlIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc3VpdGU8RCBleHRlbmRzIFJlbmRlckRlbGVnYXRlPihcbiAga2xhc3M6IFJlbmRlclRlc3RDb25zdHJ1Y3RvcjxELCBJUmVuZGVyVGVzdD4sXG4gIERlbGVnYXRlOiBSZW5kZXJEZWxlZ2F0ZUNvbnN0cnVjdG9yPEQ+LFxuICBvcHRpb25zID0geyBjb21wb25lbnRNb2R1bGU6IGZhbHNlIH1cbik6IHZvaWQge1xuICBsZXQgc3VpdGVOYW1lID0ga2xhc3Muc3VpdGVOYW1lO1xuXG4gIGlmIChvcHRpb25zLmNvbXBvbmVudE1vZHVsZSkge1xuICAgIGlmIChzaG91bGRSdW5UZXN0PEQ+KERlbGVnYXRlKSkge1xuICAgICAgY29tcG9uZW50TW9kdWxlKFxuICAgICAgICBgJHtEZWxlZ2F0ZS5zdHlsZX0gOjogQ29tcG9uZW50cyA6OiAke3N1aXRlTmFtZX1gLFxuICAgICAgICAoa2xhc3MgYXMgYW55KSBhcyBSZW5kZXJUZXN0Q29uc3RydWN0b3I8RCwgUmVuZGVyVGVzdD4sXG4gICAgICAgIERlbGVnYXRlXG4gICAgICApO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBRVW5pdC5tb2R1bGUoYFtpbnRlZ3JhdGlvbl0gJHtEZWxlZ2F0ZS5zdHlsZX0gOjogJHtzdWl0ZU5hbWV9YCk7XG5cbiAgICBmb3IgKGxldCBwcm9wIGluIGtsYXNzLnByb3RvdHlwZSkge1xuICAgICAgY29uc3QgdGVzdCA9IGtsYXNzLnByb3RvdHlwZVtwcm9wXTtcblxuICAgICAgaWYgKGlzVGVzdEZ1bmN0aW9uKHRlc3QpICYmIHNob3VsZFJ1blRlc3Q8RD4oRGVsZWdhdGUpKSB7XG4gICAgICAgIFFVbml0LnRlc3QocHJvcCwgYXNzZXJ0ID0+IHtcbiAgICAgICAgICBsZXQgaW5zdGFuY2UgPSBuZXcga2xhc3MobmV3IERlbGVnYXRlKCkpO1xuICAgICAgICAgIHRlc3QuY2FsbChpbnN0YW5jZSwgYXNzZXJ0LCBpbnN0YW5jZS5jb3VudCk7XG4gICAgICAgICAgaW5zdGFuY2UuY291bnQuYXNzZXJ0KCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBjb21wb25lbnRNb2R1bGU8RCBleHRlbmRzIFJlbmRlckRlbGVnYXRlLCBUIGV4dGVuZHMgSVJlbmRlclRlc3Q+KFxuICBuYW1lOiBzdHJpbmcsXG4gIGtsYXNzOiBSZW5kZXJUZXN0Q29uc3RydWN0b3I8RCwgVD4sXG4gIERlbGVnYXRlOiBSZW5kZXJEZWxlZ2F0ZUNvbnN0cnVjdG9yPEQ+XG4pIHtcbiAgbGV0IHRlc3RzOiBDb21wb25lbnRUZXN0cyA9IHtcbiAgICBnbGltbWVyOiBbXSxcbiAgICBjdXJseTogW10sXG4gICAgZHluYW1pYzogW10sXG4gICAgYmFzaWM6IFtdLFxuICAgIGZyYWdtZW50OiBbXSxcbiAgfTtcblxuICBmdW5jdGlvbiBjcmVhdGVUZXN0KHByb3A6IHN0cmluZywgdGVzdDogYW55LCBza2lwPzogYm9vbGVhbikge1xuICAgIGxldCBzaG91bGRTa2lwOiBib29sZWFuO1xuICAgIGlmIChza2lwID09PSB0cnVlIHx8IHRlc3Quc2tpcCA9PT0gdHJ1ZSkge1xuICAgICAgc2hvdWxkU2tpcCA9IHRydWU7XG4gICAgfVxuXG4gICAgcmV0dXJuICh0eXBlOiBDb21wb25lbnRLaW5kLCBrbGFzczogUmVuZGVyVGVzdENvbnN0cnVjdG9yPEQsIFQ+KSA9PiB7XG4gICAgICBpZiAoIXNob3VsZFNraXApIHtcbiAgICAgICAgUVVuaXQudGVzdChwcm9wLCBhc3NlcnQgPT4ge1xuICAgICAgICAgIGxldCBpbnN0YW5jZSA9IG5ldyBrbGFzcyhuZXcgRGVsZWdhdGUoKSk7XG4gICAgICAgICAgaW5zdGFuY2UudGVzdFR5cGUgPSB0eXBlO1xuICAgICAgICAgIHRlc3QuY2FsbChpbnN0YW5jZSwgYXNzZXJ0LCBpbnN0YW5jZS5jb3VudCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBmb3IgKGxldCBwcm9wIGluIGtsYXNzLnByb3RvdHlwZSkge1xuICAgIGNvbnN0IHRlc3QgPSBrbGFzcy5wcm90b3R5cGVbcHJvcF07XG4gICAgaWYgKGlzVGVzdEZ1bmN0aW9uKHRlc3QpKSB7XG4gICAgICBpZiAodGVzdFsna2luZCddID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgbGV0IHNraXAgPSB0ZXN0Wydza2lwJ107XG4gICAgICAgIHN3aXRjaCAoc2tpcCkge1xuICAgICAgICAgIGNhc2UgJ2dsaW1tZXInOlxuICAgICAgICAgICAgdGVzdHMuY3VybHkucHVzaChjcmVhdGVUZXN0KHByb3AsIHRlc3QpKTtcbiAgICAgICAgICAgIHRlc3RzLmR5bmFtaWMucHVzaChjcmVhdGVUZXN0KHByb3AsIHRlc3QpKTtcbiAgICAgICAgICAgIHRlc3RzLmdsaW1tZXIucHVzaChjcmVhdGVUZXN0KHByb3AsIHRlc3QsIHRydWUpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ2N1cmx5JzpcbiAgICAgICAgICAgIHRlc3RzLmdsaW1tZXIucHVzaChjcmVhdGVUZXN0KHByb3AsIHRlc3QpKTtcbiAgICAgICAgICAgIHRlc3RzLmR5bmFtaWMucHVzaChjcmVhdGVUZXN0KHByb3AsIHRlc3QpKTtcbiAgICAgICAgICAgIHRlc3RzLmN1cmx5LnB1c2goY3JlYXRlVGVzdChwcm9wLCB0ZXN0LCB0cnVlKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdkeW5hbWljJzpcbiAgICAgICAgICAgIHRlc3RzLmdsaW1tZXIucHVzaChjcmVhdGVUZXN0KHByb3AsIHRlc3QpKTtcbiAgICAgICAgICAgIHRlc3RzLmN1cmx5LnB1c2goY3JlYXRlVGVzdChwcm9wLCB0ZXN0KSk7XG4gICAgICAgICAgICB0ZXN0cy5keW5hbWljLnB1c2goY3JlYXRlVGVzdChwcm9wLCB0ZXN0LCB0cnVlKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIHRydWU6XG4gICAgICAgICAgICBpZiAodGVzdFsna2luZCddID09PSAnYmFzaWMnKSB7XG4gICAgICAgICAgICAgIC8vIEJhc2ljIGNvbXBvbmVudHMgYXJlIG5vdCBwYXJ0IG9mIG1hdHJpeCB0ZXN0aW5nXG4gICAgICAgICAgICAgIHRlc3RzLmJhc2ljLnB1c2goY3JlYXRlVGVzdChwcm9wLCB0ZXN0LCB0cnVlKSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRlc3RbJ2tpbmQnXSA9PT0gJ2ZyYWdtZW50Jykge1xuICAgICAgICAgICAgICB0ZXN0cy5mcmFnbWVudC5wdXNoKGNyZWF0ZVRlc3QocHJvcCwgdGVzdCwgdHJ1ZSkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgWydnbGltbWVyJywgJ2N1cmx5JywgJ2R5bmFtaWMnXS5mb3JFYWNoKGtpbmQgPT4ge1xuICAgICAgICAgICAgICAgIHRlc3RzW2tpbmQgYXMgRGVjbGFyZWRDb21wb25lbnRLaW5kXS5wdXNoKGNyZWF0ZVRlc3QocHJvcCwgdGVzdCwgdHJ1ZSkpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgdGVzdHMuZ2xpbW1lci5wdXNoKGNyZWF0ZVRlc3QocHJvcCwgdGVzdCkpO1xuICAgICAgICAgICAgdGVzdHMuY3VybHkucHVzaChjcmVhdGVUZXN0KHByb3AsIHRlc3QpKTtcbiAgICAgICAgICAgIHRlc3RzLmR5bmFtaWMucHVzaChjcmVhdGVUZXN0KHByb3AsIHRlc3QpKTtcbiAgICAgICAgfVxuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgbGV0IGtpbmQgPSB0ZXN0WydraW5kJ107XG5cbiAgICAgIGlmIChraW5kID09PSAnY3VybHknKSB7XG4gICAgICAgIHRlc3RzLmN1cmx5LnB1c2goY3JlYXRlVGVzdChwcm9wLCB0ZXN0KSk7XG4gICAgICAgIHRlc3RzLmR5bmFtaWMucHVzaChjcmVhdGVUZXN0KHByb3AsIHRlc3QpKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGtpbmQgPT09ICdnbGltbWVyJykge1xuICAgICAgICB0ZXN0cy5nbGltbWVyLnB1c2goY3JlYXRlVGVzdChwcm9wLCB0ZXN0KSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChraW5kID09PSAnZHluYW1pYycpIHtcbiAgICAgICAgdGVzdHMuY3VybHkucHVzaChjcmVhdGVUZXN0KHByb3AsIHRlc3QpKTtcbiAgICAgICAgdGVzdHMuZHluYW1pYy5wdXNoKGNyZWF0ZVRlc3QocHJvcCwgdGVzdCkpO1xuICAgICAgfVxuXG4gICAgICBpZiAoa2luZCA9PT0gJ2Jhc2ljJykge1xuICAgICAgICB0ZXN0cy5iYXNpYy5wdXNoKGNyZWF0ZVRlc3QocHJvcCwgdGVzdCkpO1xuICAgICAgfVxuXG4gICAgICBpZiAoa2luZCA9PT0gJ2ZyYWdtZW50Jykge1xuICAgICAgICB0ZXN0cy5mcmFnbWVudC5wdXNoKGNyZWF0ZVRlc3QocHJvcCwgdGVzdCkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBRVW5pdC5tb2R1bGUoYFtpbnRlZ3JhdGlvbl0gJHtuYW1lfWAsICgpID0+IHtcbiAgICBuZXN0ZWRDb21wb25lbnRNb2R1bGVzKGtsYXNzLCB0ZXN0cyk7XG4gIH0pO1xufVxuXG5pbnRlcmZhY2UgQ29tcG9uZW50VGVzdHMge1xuICBnbGltbWVyOiBGdW5jdGlvbltdO1xuICBjdXJseTogRnVuY3Rpb25bXTtcbiAgZHluYW1pYzogRnVuY3Rpb25bXTtcbiAgYmFzaWM6IEZ1bmN0aW9uW107XG4gIGZyYWdtZW50OiBGdW5jdGlvbltdO1xufVxuXG5mdW5jdGlvbiBuZXN0ZWRDb21wb25lbnRNb2R1bGVzPEQgZXh0ZW5kcyBSZW5kZXJEZWxlZ2F0ZSwgVCBleHRlbmRzIElSZW5kZXJUZXN0PihcbiAga2xhc3M6IFJlbmRlclRlc3RDb25zdHJ1Y3RvcjxELCBUPixcbiAgdGVzdHM6IENvbXBvbmVudFRlc3RzXG4pOiB2b2lkIHtcbiAga2V5cyh0ZXN0cykuZm9yRWFjaCh0eXBlID0+IHtcbiAgICBsZXQgZm9ybWF0dGVkVHlwZSA9IGAke3R5cGVbMF0udG9VcHBlckNhc2UoKSArIHR5cGUuc2xpY2UoMSl9YDtcbiAgICBRVW5pdC5tb2R1bGUoYFtpbnRlZ3JhdGlvbl0gJHtmb3JtYXR0ZWRUeXBlfWAsICgpID0+IHtcbiAgICAgIGZvciAobGV0IGkgPSB0ZXN0c1t0eXBlXS5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICBsZXQgdCA9IHRlc3RzW3R5cGVdW2ldO1xuICAgICAgICB0KGZvcm1hdHRlZFR5cGUsIGtsYXNzKTtcbiAgICAgICAgdGVzdHNbdHlwZV0ucG9wKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufVxuXG5jb25zdCBIQVNfVFlQRURfQVJSQVlTID0gdHlwZW9mIFVpbnQxNkFycmF5ICE9PSAndW5kZWZpbmVkJztcblxuZnVuY3Rpb24gc2hvdWxkUnVuVGVzdDxUIGV4dGVuZHMgUmVuZGVyRGVsZWdhdGU+KERlbGVnYXRlOiBSZW5kZXJEZWxlZ2F0ZUNvbnN0cnVjdG9yPFQ+KSB7XG4gIGxldCBpc0VhZ2VyRGVsZWdhdGUgPSBEZWxlZ2F0ZVsnaXNFYWdlciddO1xuXG4gIGlmIChIQVNfVFlQRURfQVJSQVlTKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBpZiAoIUhBU19UWVBFRF9BUlJBWVMgJiYgIWlzRWFnZXJEZWxlZ2F0ZSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5pbnRlcmZhY2UgVGVzdEZ1bmN0aW9uIHtcbiAgKHRoaXM6IElSZW5kZXJUZXN0LCBhc3NlcnQ6IHR5cGVvZiBRVW5pdC5hc3NlcnQsIGNvdW50PzogQ291bnQpOiB2b2lkO1xuICBraW5kPzogRGVjbGFyZWRDb21wb25lbnRLaW5kO1xuICBza2lwPzogYm9vbGVhbiB8IERlY2xhcmVkQ29tcG9uZW50S2luZDtcbn1cblxuZnVuY3Rpb24gaXNUZXN0RnVuY3Rpb24odmFsdWU6IGFueSk6IHZhbHVlIGlzIFRlc3RGdW5jdGlvbiB7XG4gIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicgJiYgdmFsdWUuaXNUZXN0O1xufVxuIl19