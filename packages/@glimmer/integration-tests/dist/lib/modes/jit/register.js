import { BasicComponentManager } from '../../components/basic';
import { BASIC_CAPABILITIES, STATIC_TAGLESS_CAPABILITIES, CURLY_CAPABILITIES, } from '../../components/capabilities';
import { EmberishCurlyComponent, EmberishCurlyComponentManager, } from '../../components/emberish-curly';
import { EmberishGlimmerComponent, EMBERISH_GLIMMER_CAPABILITIES, EmberishGlimmerComponentManager, } from '../../components/emberish-glimmer';
import { HelperReference } from '../../helpers';
import { TestModifierDefinitionState, TestModifierManager, } from '../../modifiers';
import { PartialDefinition } from '@glimmer/opcode-compiler';
import { locatorFor } from '../../locator';
import { curry } from '@glimmer/runtime';
import { preprocess } from '../../compile';
import { StaticTaglessComponentManager } from '../../components/static-tagless';
const BASIC_COMPONENT_MANAGER = new BasicComponentManager();
const EMBERISH_CURLY_COMPONENT_MANAGER = new EmberishCurlyComponentManager();
const EMBERISH_GLIMMER_COMPONENT_MANAGER = new EmberishGlimmerComponentManager();
const STATIC_TAGLESS_COMPONENT_MANAGER = new StaticTaglessComponentManager();
export function registerTemplate(registry, name, source) {
    return { name, handle: registry.register('template-source', name, source) };
}
export function registerBasicComponent(registry, name, Component, layoutSource) {
    if (name.indexOf('-') !== -1) {
        throw new Error('DEPRECATED: dasherized components');
    }
    let { handle } = registerTemplate(registry, name, layoutSource);
    registerSomeComponent(registry, name, 'Basic', BASIC_COMPONENT_MANAGER, handle, Component, BASIC_CAPABILITIES);
}
export function registerStaticTaglessComponent(registry, name, Component, layoutSource) {
    let { handle } = registerTemplate(registry, name, layoutSource);
    registerSomeComponent(registry, name, 'Fragment', STATIC_TAGLESS_COMPONENT_MANAGER, handle, Component, STATIC_TAGLESS_CAPABILITIES);
}
export function registerEmberishCurlyComponent(registry, name, Component, layoutSource) {
    let layout = null;
    if (layoutSource !== null) {
        layout = registerTemplate(registry, name, layoutSource);
    }
    let handle = layout ? layout.handle : null;
    let ComponentClass = Component || EmberishCurlyComponent;
    registerSomeComponent(registry, name, 'Curly', EMBERISH_CURLY_COMPONENT_MANAGER, handle, ComponentClass, CURLY_CAPABILITIES);
}
export function registerEmberishGlimmerComponent(registry, name, Component, layoutSource) {
    if (name.indexOf('-') !== -1) {
        throw new Error('DEPRECATED: dasherized components');
    }
    let { handle } = registerTemplate(registry, name, layoutSource);
    let ComponentClass = Component || EmberishGlimmerComponent;
    registerSomeComponent(registry, name, 'Glimmer', EMBERISH_GLIMMER_COMPONENT_MANAGER, handle, ComponentClass, EMBERISH_GLIMMER_CAPABILITIES);
}
export function registerHelper(registry, name, helper) {
    let glimmerHelper = args => new HelperReference(helper, args);
    registry.register('helper', name, glimmerHelper);
    return glimmerHelper;
}
export function registerInternalHelper(registry, name, helper) {
    registry.register('helper', name, helper);
    return helper;
}
export function registerInternalModifier(registry, name, manager, state) {
    registry.register('modifier', name, { manager, state });
}
export function registerModifier(registry, name, ModifierClass) {
    let state = new TestModifierDefinitionState(ModifierClass);
    let manager = new TestModifierManager();
    registry.register('modifier', name, { manager, state });
    return { manager, state };
}
export function registerPartial(registry, name, source) {
    let definition = new PartialDefinition(name, preprocess(source));
    registry.register('partial', name, definition);
    return definition;
}
export function resolveHelper(resolver, helperName) {
    let handle = resolver.lookupHelper(helperName);
    return typeof handle === 'number' ? resolver.resolve(handle) : null;
}
export function resolvePartial(resolver, partialName) {
    let handle = resolver.lookupPartial(partialName);
    return typeof handle === 'number' ? resolver.resolve(handle) : null;
}
export function registerComponent(registry, type, name, layout, Class) {
    switch (type) {
        case 'Glimmer':
            registerEmberishGlimmerComponent(registry, name, Class, layout);
            break;
        case 'Curly':
            registerEmberishCurlyComponent(registry, name, Class, layout);
            break;
        case 'Dynamic':
            registerEmberishCurlyComponent(registry, name, Class, layout);
            break;
        case 'Basic':
        case 'Fragment':
            registerBasicComponent(registry, name, Class, layout);
            break;
    }
}
function registerSomeComponent(registry, name, type, manager, layout, ComponentClass, capabilities) {
    let state = {
        name,
        type,
        layout,
        locator: locatorFor({ module: name, name: 'default' }),
        capabilities,
        ComponentClass,
    };
    let definition = {
        state,
        manager,
    };
    registry.register('component', name, definition);
    return definition;
}
export function componentHelper(resolver, registry, name) {
    let handle = registry.lookupComponentHandle(name);
    if (handle === null)
        return null;
    let spec = resolver.resolve(handle);
    return curry(spec);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVnaXN0ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9saWIvbW9kZXMvaml0L3JlZ2lzdGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxxQkFBcUIsRUFBa0IsTUFBTSx3QkFBd0IsQ0FBQztBQUMvRSxPQUFPLEVBQ0wsa0JBQWtCLEVBQ2xCLDJCQUEyQixFQUMzQixrQkFBa0IsR0FDbkIsTUFBTSwrQkFBK0IsQ0FBQztBQVN2QyxPQUFPLEVBQ0wsc0JBQXNCLEVBQ3RCLDZCQUE2QixHQUM5QixNQUFNLGlDQUFpQyxDQUFDO0FBQ3pDLE9BQU8sRUFDTCx3QkFBd0IsRUFDeEIsNkJBQTZCLEVBQzdCLCtCQUErQixHQUNoQyxNQUFNLG1DQUFtQyxDQUFDO0FBQzNDLE9BQU8sRUFBYyxlQUFlLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDNUQsT0FBTyxFQUVMLDJCQUEyQixFQUMzQixtQkFBbUIsR0FDcEIsTUFBTSxpQkFBaUIsQ0FBQztBQUN6QixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUk3RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBOEIsS0FBSyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDckUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsNkJBQTZCLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUVoRixNQUFNLHVCQUF1QixHQUFHLElBQUkscUJBQXFCLEVBQUUsQ0FBQztBQUM1RCxNQUFNLGdDQUFnQyxHQUFHLElBQUksNkJBQTZCLEVBQUUsQ0FBQztBQUM3RSxNQUFNLGtDQUFrQyxHQUFHLElBQUksK0JBQStCLEVBQUUsQ0FBQztBQUNqRixNQUFNLGdDQUFnQyxHQUFHLElBQUksNkJBQTZCLEVBQUUsQ0FBQztBQUU3RSxNQUFNLFVBQVUsZ0JBQWdCLENBQzlCLFFB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QUFtQixFQUNuQixPQUEyQyxFQUMzQyxNQUFzQixFQUN0QixjQUF1QixFQUN2QixZQUFtQztJQUVuQyxJQUFJLEtBQUssR0FBaUM7UUFDeEMsSUFBSTtRQUNKLElBQUk7UUFDSixNQUFNO1FBQ04sT0FBTyxFQUFFLFVBQVUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxDQUFDO1FBQ3RELFlBQVk7UUFDWixjQUFjO0tBQ2YsQ0FBQztJQUVGLElBQUksVUFBVSxHQUFHO1FBQ2YsS0FBSztRQUNMLE9BQU87S0FDUixDQUFDO0lBRUYsUUFBUSxDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBQ2pELE9BQU8sVUFBVSxDQUFDO0FBQ3BCLENBQUM7QUFFRCxNQUFNLFVBQVUsZUFBZSxDQUM3QixRQUFnQyxFQUNoQyxRQUF5QixFQUN6QixJQUFZO0lBRVosSUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQyxDQUFDO0lBRWxELElBQUksTUFBTSxLQUFLLElBQUk7UUFBRSxPQUFPLElBQUksQ0FBQztJQUVqQyxJQUFJLElBQUksR0FBRyxRQUFRLENBQUMsT0FBTyxDQUFzQixNQUFNLENBQUMsQ0FBQztJQUN6RCxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNyQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVzdEppdFJlZ2lzdHJ5IH0gZnJvbSAnLi9yZWdpc3RyeSc7XG5pbXBvcnQgeyBCYXNpY0NvbXBvbmVudE1hbmFnZXIsIEJhc2ljQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vY29tcG9uZW50cy9iYXNpYyc7XG5pbXBvcnQge1xuICBCQVNJQ19DQVBBQklMSVRJRVMsXG4gIFNUQVRJQ19UQUdMRVNTX0NBUEFCSUxJVElFUyxcbiAgQ1VSTFlfQ0FQQUJJTElUSUVTLFxufSBmcm9tICcuLi8uLi9jb21wb25lbnRzL2NhcGFiaWxpdGllcyc7XG5pbXBvcnQge1xuICBPcHRpb24sXG4gIEhlbHBlciBhcyBHbGltbWVySGVscGVyLFxuICBNb2RpZmllck1hbmFnZXIsXG4gIENvbXBvbmVudE1hbmFnZXIsXG4gIENvbXBvbmVudENhcGFiaWxpdGllcyxcbiAgQ29tcG9uZW50RGVmaW5pdGlvbixcbn0gZnJvbSAnQGdsaW1tZXIvaW50ZXJmYWNlcyc7XG5pbXBvcnQge1xuICBFbWJlcmlzaEN1cmx5Q29tcG9uZW50LFxuICBFbWJlcmlzaEN1cmx5Q29tcG9uZW50TWFuYWdlcixcbn0gZnJvbSAnLi4vLi4vY29tcG9uZW50cy9lbWJlcmlzaC1jdXJseSc7XG5pbXBvcnQge1xuICBFbWJlcmlzaEdsaW1tZXJDb21wb25lbnQsXG4gIEVNQkVSSVNIX0dMSU1NRVJfQ0FQQUJJTElUSUVTLFxuICBFbWJlcmlzaEdsaW1tZXJDb21wb25lbnRNYW5hZ2VyLFxufSBmcm9tICcuLi8uLi9jb21wb25lbnRzL2VtYmVyaXNoLWdsaW1tZXInO1xuaW1wb3J0IHsgVXNlckhlbHBlciwgSGVscGVyUmVmZXJlbmNlIH0gZnJvbSAnLi4vLi4vaGVscGVycyc7XG5pbXBvcnQge1xuICBUZXN0TW9kaWZpZXJDb25zdHJ1Y3RvcixcbiAgVGVzdE1vZGlmaWVyRGVmaW5pdGlvblN0YXRlLFxuICBUZXN0TW9kaWZpZXJNYW5hZ2VyLFxufSBmcm9tICcuLi8uLi9tb2RpZmllcnMnO1xuaW1wb3J0IHsgUGFydGlhbERlZmluaXRpb24gfSBmcm9tICdAZ2xpbW1lci9vcGNvZGUtY29tcGlsZXInO1xuaW1wb3J0IFRlc3RKaXRSdW50aW1lUmVzb2x2ZXIgZnJvbSAnLi9yZXNvbHZlcic7XG5pbXBvcnQgeyBDb21wb25lbnRLaW5kLCBDb21wb25lbnRUeXBlcyB9IGZyb20gJy4uLy4uL2NvbXBvbmVudHMnO1xuaW1wb3J0IHsgVGVzdENvbXBvbmVudERlZmluaXRpb25TdGF0ZSB9IGZyb20gJy4uLy4uL2NvbXBvbmVudHMvdGVzdC1jb21wb25lbnQnO1xuaW1wb3J0IHsgbG9jYXRvckZvciB9IGZyb20gJy4uLy4uL2xvY2F0b3InO1xuaW1wb3J0IHsgQ3VycmllZENvbXBvbmVudERlZmluaXRpb24sIGN1cnJ5IH0gZnJvbSAnQGdsaW1tZXIvcnVudGltZSc7XG5pbXBvcnQgeyBwcmVwcm9jZXNzIH0gZnJvbSAnLi4vLi4vY29tcGlsZSc7XG5pbXBvcnQgeyBTdGF0aWNUYWdsZXNzQ29tcG9uZW50TWFuYWdlciB9IGZyb20gJy4uLy4uL2NvbXBvbmVudHMvc3RhdGljLXRhZ2xlc3MnO1xuXG5jb25zdCBCQVNJQ19DT01QT05FTlRfTUFOQUdFUiA9IG5ldyBCYXNpY0NvbXBvbmVudE1hbmFnZXIoKTtcbmNvbnN0IEVNQkVSSVNIX0NVUkxZX0NPTVBPTkVOVF9NQU5BR0VSID0gbmV3IEVtYmVyaXNoQ3VybHlDb21wb25lbnRNYW5hZ2VyKCk7XG5jb25zdCBFTUJFUklTSF9HTElNTUVSX0NPTVBPTkVOVF9NQU5BR0VSID0gbmV3IEVtYmVyaXNoR2xpbW1lckNvbXBvbmVudE1hbmFnZXIoKTtcbmNvbnN0IFNUQVRJQ19UQUdMRVNTX0NPTVBPTkVOVF9NQU5BR0VSID0gbmV3IFN0YXRpY1RhZ2xlc3NDb21wb25lbnRNYW5hZ2VyKCk7XG5cbmV4cG9ydCBmdW5jdGlvbiByZWdpc3RlclRlbXBsYXRlKFxuICByZWdpc3RyeTogVGVzdEppdFJlZ2lzdHJ5LFxuICBuYW1lOiBzdHJpbmcsXG4gIHNvdXJjZTogc3RyaW5nXG4pOiB7IG5hbWU6IHN0cmluZzsgaGFuZGxlOiBudW1iZXIgfSB7XG4gIHJldHVybiB7IG5hbWUsIGhhbmRsZTogcmVnaXN0cnkucmVnaXN0ZXIoJ3RlbXBsYXRlLXNvdXJjZScsIG5hbWUsIHNvdXJjZSkgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyQmFzaWNDb21wb25lbnQoXG4gIHJlZ2lzdHJ5OiBUZXN0Sml0UmVnaXN0cnksXG4gIG5hbWU6IHN0cmluZyxcbiAgQ29tcG9uZW50OiBDb21wb25lbnRUeXBlc1snQmFzaWMnXSxcbiAgbGF5b3V0U291cmNlOiBzdHJpbmdcbik6IHZvaWQge1xuICBpZiAobmFtZS5pbmRleE9mKCctJykgIT09IC0xKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdERVBSRUNBVEVEOiBkYXNoZXJpemVkIGNvbXBvbmVudHMnKTtcbiAgfVxuXG4gIGxldCB7IGhhbmRsZSB9ID0gcmVnaXN0ZXJUZW1wbGF0ZShyZWdpc3RyeSwgbmFtZSwgbGF5b3V0U291cmNlKTtcblxuICByZWdpc3RlclNvbWVDb21wb25lbnQoXG4gICAgcmVnaXN0cnksXG4gICAgbmFtZSxcbiAgICAnQmFzaWMnLFxuICAgIEJBU0lDX0NPTVBPTkVOVF9NQU5BR0VSLFxuICAgIGhhbmRsZSxcbiAgICBDb21wb25lbnQsXG4gICAgQkFTSUNfQ0FQQUJJTElUSUVTXG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZWdpc3RlclN0YXRpY1RhZ2xlc3NDb21wb25lbnQoXG4gIHJlZ2lzdHJ5OiBUZXN0Sml0UmVnaXN0cnksXG4gIG5hbWU6IHN0cmluZyxcbiAgQ29tcG9uZW50OiBDb21wb25lbnRUeXBlc1snQmFzaWMnXSxcbiAgbGF5b3V0U291cmNlOiBzdHJpbmdcbik6IHZvaWQge1xuICBsZXQgeyBoYW5kbGUgfSA9IHJlZ2lzdGVyVGVtcGxhdGUocmVnaXN0cnksIG5hbWUsIGxheW91dFNvdXJjZSk7XG5cbiAgcmVnaXN0ZXJTb21lQ29tcG9uZW50KFxuICAgIHJlZ2lzdHJ5LFxuICAgIG5hbWUsXG4gICAgJ0ZyYWdtZW50JyxcbiAgICBTVEFUSUNfVEFHTEVTU19DT01QT05FTlRfTUFOQUdFUixcbiAgICBoYW5kbGUsXG4gICAgQ29tcG9uZW50LFxuICAgIFNUQVRJQ19UQUdMRVNTX0NBUEFCSUxJVElFU1xuICApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJFbWJlcmlzaEN1cmx5Q29tcG9uZW50KFxuICByZWdpc3RyeTogVGVzdEppdFJlZ2lzdHJ5LFxuICBuYW1lOiBzdHJpbmcsXG4gIENvbXBvbmVudDogT3B0aW9uPENvbXBvbmVudFR5cGVzWydDdXJseSddPixcbiAgbGF5b3V0U291cmNlOiBPcHRpb248c3RyaW5nPlxuKTogdm9pZCB7XG4gIGxldCBsYXlvdXQ6IE9wdGlvbjx7IG5hbWU6IHN0cmluZzsgaGFuZGxlOiBudW1iZXIgfT4gPSBudWxsO1xuXG4gIGlmIChsYXlvdXRTb3VyY2UgIT09IG51bGwpIHtcbiAgICBsYXlvdXQgPSByZWdpc3RlclRlbXBsYXRlKHJlZ2lzdHJ5LCBuYW1lLCBsYXlvdXRTb3VyY2UpO1xuICB9XG5cbiAgbGV0IGhhbmRsZSA9IGxheW91dCA/IGxheW91dC5oYW5kbGUgOiBudWxsO1xuICBsZXQgQ29tcG9uZW50Q2xhc3MgPSBDb21wb25lbnQgfHwgRW1iZXJpc2hDdXJseUNvbXBvbmVudDtcblxuICByZWdpc3RlclNvbWVDb21wb25lbnQoXG4gICAgcmVnaXN0cnksXG4gICAgbmFtZSxcbiAgICAnQ3VybHknLFxuICAgIEVNQkVSSVNIX0NVUkxZX0NPTVBPTkVOVF9NQU5BR0VSLFxuICAgIGhhbmRsZSxcbiAgICBDb21wb25lbnRDbGFzcyxcbiAgICBDVVJMWV9DQVBBQklMSVRJRVNcbiAgKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyRW1iZXJpc2hHbGltbWVyQ29tcG9uZW50KFxuICByZWdpc3RyeTogVGVzdEppdFJlZ2lzdHJ5LFxuICBuYW1lOiBzdHJpbmcsXG4gIENvbXBvbmVudDogT3B0aW9uPENvbXBvbmVudFR5cGVzWydHbGltbWVyJ10+LFxuICBsYXlvdXRTb3VyY2U6IHN0cmluZ1xuKTogdm9pZCB7XG4gIGlmIChuYW1lLmluZGV4T2YoJy0nKSAhPT0gLTEpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0RFUFJFQ0FURUQ6IGRhc2hlcml6ZWQgY29tcG9uZW50cycpO1xuICB9XG5cbiAgbGV0IHsgaGFuZGxlIH0gPSByZWdpc3RlclRlbXBsYXRlKHJlZ2lzdHJ5LCBuYW1lLCBsYXlvdXRTb3VyY2UpO1xuXG4gIGxldCBDb21wb25lbnRDbGFzcyA9IENvbXBvbmVudCB8fCBFbWJlcmlzaEdsaW1tZXJDb21wb25lbnQ7XG5cbiAgcmVnaXN0ZXJTb21lQ29tcG9uZW50KFxuICAgIHJlZ2lzdHJ5LFxuICAgIG5hbWUsXG4gICAgJ0dsaW1tZXInLFxuICAgIEVNQkVSSVNIX0dMSU1NRVJfQ09NUE9ORU5UX01BTkFHRVIsXG4gICAgaGFuZGxlLFxuICAgIENvbXBvbmVudENsYXNzLFxuICAgIEVNQkVSSVNIX0dMSU1NRVJfQ0FQQUJJTElUSUVTXG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZWdpc3RlckhlbHBlcihcbiAgcmVnaXN0cnk6IFRlc3RKaXRSZWdpc3RyeSxcbiAgbmFtZTogc3RyaW5nLFxuICBoZWxwZXI6IFVzZXJIZWxwZXJcbik6IEdsaW1tZXJIZWxwZXIge1xuICBsZXQgZ2xpbW1lckhlbHBlcjogR2xpbW1lckhlbHBlciA9IGFyZ3MgPT4gbmV3IEhlbHBlclJlZmVyZW5jZShoZWxwZXIsIGFyZ3MpO1xuICByZWdpc3RyeS5yZWdpc3RlcignaGVscGVyJywgbmFtZSwgZ2xpbW1lckhlbHBlcik7XG4gIHJldHVybiBnbGltbWVySGVscGVyO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJJbnRlcm5hbEhlbHBlcihcbiAgcmVnaXN0cnk6IFRlc3RKaXRSZWdpc3RyeSxcbiAgbmFtZTogc3RyaW5nLFxuICBoZWxwZXI6IEdsaW1tZXJIZWxwZXJcbik6IEdsaW1tZXJIZWxwZXIge1xuICByZWdpc3RyeS5yZWdpc3RlcignaGVscGVyJywgbmFtZSwgaGVscGVyKTtcbiAgcmV0dXJuIGhlbHBlcjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVySW50ZXJuYWxNb2RpZmllcihcbiAgcmVnaXN0cnk6IFRlc3RKaXRSZWdpc3RyeSxcbiAgbmFtZTogc3RyaW5nLFxuICBtYW5hZ2VyOiBNb2RpZmllck1hbmFnZXI8dW5rbm93biwgdW5rbm93bj4sXG4gIHN0YXRlOiB1bmtub3duXG4pIHtcbiAgcmVnaXN0cnkucmVnaXN0ZXIoJ21vZGlmaWVyJywgbmFtZSwgeyBtYW5hZ2VyLCBzdGF0ZSB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyTW9kaWZpZXIoXG4gIHJlZ2lzdHJ5OiBUZXN0Sml0UmVnaXN0cnksXG4gIG5hbWU6IHN0cmluZyxcbiAgTW9kaWZpZXJDbGFzcz86IFRlc3RNb2RpZmllckNvbnN0cnVjdG9yXG4pIHtcbiAgbGV0IHN0YXRlID0gbmV3IFRlc3RNb2RpZmllckRlZmluaXRpb25TdGF0ZShNb2RpZmllckNsYXNzKTtcbiAgbGV0IG1hbmFnZXIgPSBuZXcgVGVzdE1vZGlmaWVyTWFuYWdlcigpO1xuICByZWdpc3RyeS5yZWdpc3RlcignbW9kaWZpZXInLCBuYW1lLCB7IG1hbmFnZXIsIHN0YXRlIH0pO1xuICByZXR1cm4geyBtYW5hZ2VyLCBzdGF0ZSB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJQYXJ0aWFsKFxuICByZWdpc3RyeTogVGVzdEppdFJlZ2lzdHJ5LFxuICBuYW1lOiBzdHJpbmcsXG4gIHNvdXJjZTogc3RyaW5nXG4pOiBQYXJ0aWFsRGVmaW5pdGlvbiB7XG4gIGxldCBkZWZpbml0aW9uID0gbmV3IFBhcnRpYWxEZWZpbml0aW9uKG5hbWUsIHByZXByb2Nlc3Moc291cmNlKSk7XG4gIHJlZ2lzdHJ5LnJlZ2lzdGVyKCdwYXJ0aWFsJywgbmFtZSwgZGVmaW5pdGlvbik7XG4gIHJldHVybiBkZWZpbml0aW9uO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVzb2x2ZUhlbHBlcihcbiAgcmVzb2x2ZXI6IFRlc3RKaXRSdW50aW1lUmVzb2x2ZXIsXG4gIGhlbHBlck5hbWU6IHN0cmluZ1xuKTogT3B0aW9uPEdsaW1tZXJIZWxwZXI+IHtcbiAgbGV0IGhhbmRsZSA9IHJlc29sdmVyLmxvb2t1cEhlbHBlcihoZWxwZXJOYW1lKTtcbiAgcmV0dXJuIHR5cGVvZiBoYW5kbGUgPT09ICdudW1iZXInID8gcmVzb2x2ZXIucmVzb2x2ZTxHbGltbWVySGVscGVyPihoYW5kbGUpIDogbnVsbDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlc29sdmVQYXJ0aWFsKFxuICByZXNvbHZlcjogVGVzdEppdFJ1bnRpbWVSZXNvbHZlcixcbiAgcGFydGlhbE5hbWU6IHN0cmluZ1xuKTogT3B0aW9uPFBhcnRpYWxEZWZpbml0aW9uPiB7XG4gIGxldCBoYW5kbGUgPSByZXNvbHZlci5sb29rdXBQYXJ0aWFsKHBhcnRpYWxOYW1lKTtcbiAgcmV0dXJuIHR5cGVvZiBoYW5kbGUgPT09ICdudW1iZXInID8gcmVzb2x2ZXIucmVzb2x2ZTxQYXJ0aWFsRGVmaW5pdGlvbj4oaGFuZGxlKSA6IG51bGw7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZWdpc3RlckNvbXBvbmVudDxLIGV4dGVuZHMgQ29tcG9uZW50S2luZD4oXG4gIHJlZ2lzdHJ5OiBUZXN0Sml0UmVnaXN0cnksXG4gIHR5cGU6IEssXG4gIG5hbWU6IHN0cmluZyxcbiAgbGF5b3V0OiBzdHJpbmcsXG4gIENsYXNzPzogQ29tcG9uZW50VHlwZXNbS11cbik6IHZvaWQge1xuICBzd2l0Y2ggKHR5cGUpIHtcbiAgICBjYXNlICdHbGltbWVyJzpcbiAgICAgIHJlZ2lzdGVyRW1iZXJpc2hHbGltbWVyQ29tcG9uZW50KHJlZ2lzdHJ5LCBuYW1lLCBDbGFzcyBhcyBDb21wb25lbnRUeXBlc1snR2xpbW1lciddLCBsYXlvdXQpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnQ3VybHknOlxuICAgICAgcmVnaXN0ZXJFbWJlcmlzaEN1cmx5Q29tcG9uZW50KHJlZ2lzdHJ5LCBuYW1lLCBDbGFzcyBhcyBDb21wb25lbnRUeXBlc1snQ3VybHknXSwgbGF5b3V0KTtcbiAgICAgIGJyZWFrO1xuXG4gICAgY2FzZSAnRHluYW1pYyc6XG4gICAgICByZWdpc3RlckVtYmVyaXNoQ3VybHlDb21wb25lbnQoXG4gICAgICAgIHJlZ2lzdHJ5LFxuICAgICAgICBuYW1lLFxuICAgICAgICBDbGFzcyBhcyB0eXBlb2YgRW1iZXJpc2hDdXJseUNvbXBvbmVudCxcbiAgICAgICAgbGF5b3V0XG4gICAgICApO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnQmFzaWMnOlxuICAgIGNhc2UgJ0ZyYWdtZW50JzpcbiAgICAgIHJlZ2lzdGVyQmFzaWNDb21wb25lbnQocmVnaXN0cnksIG5hbWUsIENsYXNzIGFzIHR5cGVvZiBCYXNpY0NvbXBvbmVudCwgbGF5b3V0KTtcbiAgICAgIGJyZWFrO1xuICB9XG59XG5cbmZ1bmN0aW9uIHJlZ2lzdGVyU29tZUNvbXBvbmVudChcbiAgcmVnaXN0cnk6IFRlc3RKaXRSZWdpc3RyeSxcbiAgbmFtZTogc3RyaW5nLFxuICB0eXBlOiBDb21wb25lbnRLaW5kLFxuICBtYW5hZ2VyOiBDb21wb25lbnRNYW5hZ2VyPHVua25vd24sIHVua25vd24+LFxuICBsYXlvdXQ6IE9wdGlvbjxudW1iZXI+LFxuICBDb21wb25lbnRDbGFzczogdW5rbm93bixcbiAgY2FwYWJpbGl0aWVzOiBDb21wb25lbnRDYXBhYmlsaXRpZXNcbikge1xuICBsZXQgc3RhdGU6IFRlc3RDb21wb25lbnREZWZpbml0aW9uU3RhdGUgPSB7XG4gICAgbmFtZSxcbiAgICB0eXBlLFxuICAgIGxheW91dCxcbiAgICBsb2NhdG9yOiBsb2NhdG9yRm9yKHsgbW9kdWxlOiBuYW1lLCBuYW1lOiAnZGVmYXVsdCcgfSksXG4gICAgY2FwYWJpbGl0aWVzLFxuICAgIENvbXBvbmVudENsYXNzLFxuICB9O1xuXG4gIGxldCBkZWZpbml0aW9uID0ge1xuICAgIHN0YXRlLFxuICAgIG1hbmFnZXIsXG4gIH07XG5cbiAgcmVnaXN0cnkucmVnaXN0ZXIoJ2NvbXBvbmVudCcsIG5hbWUsIGRlZmluaXRpb24pO1xuICByZXR1cm4gZGVmaW5pdGlvbjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBvbmVudEhlbHBlcihcbiAgcmVzb2x2ZXI6IFRlc3RKaXRSdW50aW1lUmVzb2x2ZXIsXG4gIHJlZ2lzdHJ5OiBUZXN0Sml0UmVnaXN0cnksXG4gIG5hbWU6IHN0cmluZ1xuKTogT3B0aW9uPEN1cnJpZWRDb21wb25lbnREZWZpbml0aW9uPiB7XG4gIGxldCBoYW5kbGUgPSByZWdpc3RyeS5sb29rdXBDb21wb25lbnRIYW5kbGUobmFtZSk7XG5cbiAgaWYgKGhhbmRsZSA9PT0gbnVsbCkgcmV0dXJuIG51bGw7XG5cbiAgbGV0IHNwZWMgPSByZXNvbHZlci5yZXNvbHZlPENvbXBvbmVudERlZmluaXRpb24+KGhhbmRsZSk7XG4gIHJldHVybiBjdXJyeShzcGVjKTtcbn1cbiJdfQ==