import { assert, dict } from '@glimmer/util';
export class Modules {
    constructor() {
        this.registry = dict();
    }
    has(name) {
        return name in this.registry;
    }
    get(name) {
        return this.registry[name];
    }
    type(name) {
        let module = this.registry[name];
        return module.type;
    }
    register(name, type, value) {
        assert(name.indexOf('ui/components/ui') === -1, `BUG: ui/components/ui shouldn't be a prefix`);
        assert(!name.match(/^[A-Z]/), 'BUG: Components should be nested under ui/components');
        this.registry[name] = new Module(value, type);
    }
    resolve(name, referrer, defaultRoot) {
        let local = referrer &&
            referrer.locator.module &&
            referrer.locator.module.replace(/^((.*)\/)?([^\/]*)$/, `$1${name}`);
        if (local && this.registry[local]) {
            return local;
        }
        else if (defaultRoot && this.registry[`${defaultRoot}/${name}`]) {
            return `${defaultRoot}/${name}`;
        }
        else if (this.registry[name]) {
            return name;
        }
        else {
            return null;
        }
    }
}
export class Module {
    constructor(dict, type) {
        this.dict = dict;
        this.type = type;
        Object.freeze(this.dict);
    }
    has(key) {
        return key in this.dict;
    }
    get(key) {
        return this.dict[key];
    }
}
export class AotCompilerRegistry {
    constructor(components = dict(), modules = new Modules()) {
        this.components = components;
        this.modules = modules;
    }
    register(name, type, value) {
        this.modules.register(name, type, value);
    }
    addComponent(name, manager, state) {
        this.components[name] = { manager, state };
    }
    resolve(name, referrer, { expected, root } = {}) {
        let moduleName = this.modules.resolve(name, referrer, root);
        if (moduleName === null)
            return null;
        let type = this.modules.type(moduleName);
        if (expected === undefined || type === expected) {
            return moduleName;
        }
        else {
            return null;
        }
    }
    get(name) {
        return this.modules.get(name);
    }
    type(name) {
        return this.modules.type(name);
    }
    getComponentCapabilities(meta) {
        return this.components[meta.locator.module].state.capabilities;
    }
}
export default class EagerCompilerDelegate {
    constructor(registry) {
        this.registry = registry;
    }
    hasComponentInScope(componentName, referrer) {
        let name = this.registry.resolve(componentName, referrer, {
            root: 'ui/components',
            expected: 'component',
        });
        return !!name;
    }
    resolveComponent(componentName, referrer) {
        return {
            module: this.registry.resolve(componentName, referrer, { root: 'ui/components' }),
            name: 'default',
        };
    }
    getComponentCapabilities(meta) {
        return this.registry.getComponentCapabilities(meta);
    }
    hasHelperInScope(helperName, referrer) {
        return !!this.registry.resolve(helperName, referrer, { expected: 'helper' });
    }
    resolveHelper(helperName, referrer) {
        return { module: this.registry.resolve(helperName, referrer), name: 'default' };
    }
    hasModifierInScope(modifierName, referrer) {
        return !!this.registry.resolve(modifierName, referrer, { expected: 'modifier' });
    }
    resolveModifier(modifierName, referrer) {
        return {
            module: this.registry.resolve(modifierName, referrer, { root: 'ui/components' }),
            name: 'default',
        };
    }
    hasPartialInScope(_partialName, _referrer) {
        return false;
    }
    resolvePartial(_partialName, _referrer) {
        throw new Error('Method not implemented.');
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVnaXN0cnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9saWIvbW9kZXMvYW90L3JlZ2lzdHJ5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQVVBLE9BQU8sRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRzdDLE1BQU0sT0FBTyxPQUFPO0lBQXBCO1FBQ1UsYUFBUSxHQUFHLElBQUksRUFBVSxDQUFDO0lBd0NwQyxDQUFDO0lBdENDLEdBQUcsQ0FBQyxJQUFZO1FBQ2QsT0FBTyxJQUFJLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQztJQUMvQixDQUFDO0lBRUQsR0FBRyxDQUFDLElBQVk7UUFDZCxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUVELElBQUksQ0FBQyxJQUFZO1FBQ2YsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNqQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDckIsQ0FBQztJQUVELFFBQVEsQ0FBQyxJQUFZLEVBQUUsSUFBZ0IsRUFBRSxLQUFvQjtRQUMzRCxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLDZDQUE2QyxDQUFDLENBQUM7UUFDL0YsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsRUFBRSxzREFBc0QsQ0FBQyxDQUFDO1FBQ3RGLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxNQUFNLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFFRCxPQUFPLENBQ0wsSUFBWSxFQUNaLFFBQXNDLEVBQ3RDLFdBQW9CO1FBRXBCLElBQUksS0FBSyxHQUNQLFFBQVE7WUFDUixRQUFRLENBQUMsT0FBTyxDQUFDLE1BQU07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QyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSxRQUFRLEVBQUUsRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFFLENBQUMsQ0FBQztJQUNuRixDQUFDO0lBRUQsZUFBZSxDQUFDLFlBQW9CLEVBQUUsUUFBc0M7UUFDMUUsT0FBTztZQUNMLE1BQU0sRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsUUFBUSxFQUFFLEVBQUUsSUFBSSxFQUFFLGVBQWUsRUFBRSxDQUFFO1lBQ2pGLElBQUksRUFBRSxTQUFTO1NBQ2hCLENBQUM7SUFDSixDQUFDO0lBRUQsaUJBQWlCLENBQUMsWUFBb0IsRUFBRSxTQUF1QztRQUM3RSxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFFRCxjQUFjLENBQUMsWUFBb0IsRUFBRSxTQUF1QztRQUMxRSxNQUFNLElBQUksS0FBSyxDQUFDLHlCQUF5QixDQUFDLENBQUM7SUFDN0MsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcGlsZXJEZWxlZ2F0ZSB9IGZyb20gJ0BnbGltbWVyL2J1bmRsZS1jb21waWxlcic7XG5pbXBvcnQge1xuICBDb21wb25lbnRDYXBhYmlsaXRpZXMsXG4gIENvbXBvbmVudERlZmluaXRpb24sXG4gIENvbXBvbmVudE1hbmFnZXIsXG4gIERpY3QsXG4gIE1vZHVsZUxvY2F0b3IsXG4gIE9wdGlvbixcbiAgVGVtcGxhdGVNZXRhLFxufSBmcm9tICdAZ2xpbW1lci9pbnRlcmZhY2VzJztcbmltcG9ydCB7IGFzc2VydCwgZGljdCB9IGZyb20gJ0BnbGltbWVyL3V0aWwnO1xuaW1wb3J0IHsgV3JhcHBlZExvY2F0b3IsIFRlc3RDb21wb25lbnREZWZpbml0aW9uU3RhdGUgfSBmcm9tICcuLi8uLi9jb21wb25lbnRzL3Rlc3QtY29tcG9uZW50JztcblxuZXhwb3J0IGNsYXNzIE1vZHVsZXMge1xuICBwcml2YXRlIHJlZ2lzdHJ5ID0gZGljdDxNb2R1bGU+KCk7XG5cbiAgaGFzKG5hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBuYW1lIGluIHRoaXMucmVnaXN0cnk7XG4gIH1cblxuICBnZXQobmFtZTogc3RyaW5nKTogTW9kdWxlIHtcbiAgICByZXR1cm4gdGhpcy5yZWdpc3RyeVtuYW1lXTtcbiAgfVxuXG4gIHR5cGUobmFtZTogc3RyaW5nKTogTW9kdWxlVHlwZSB7XG4gICAgbGV0IG1vZHVsZSA9IHRoaXMucmVnaXN0cnlbbmFtZV07XG4gICAgcmV0dXJuIG1vZHVsZS50eXBlO1xuICB9XG5cbiAgcmVnaXN0ZXIobmFtZTogc3RyaW5nLCB0eXBlOiBNb2R1bGVUeXBlLCB2YWx1ZTogRGljdDx1bmtub3duPikge1xuICAgIGFzc2VydChuYW1lLmluZGV4T2YoJ3VpL2NvbXBvbmVudHMvdWknKSA9PT0gLTEsIGBCVUc6IHVpL2NvbXBvbmVudHMvdWkgc2hvdWxkbid0IGJlIGEgcHJlZml4YCk7XG4gICAgYXNzZXJ0KCFuYW1lLm1hdGNoKC9eW0EtWl0vKSwgJ0JVRzogQ29tcG9uZW50cyBzaG91bGQgYmUgbmVzdGVkIHVuZGVyIHVpL2NvbXBvbmVudHMnKTtcbiAgICB0aGlzLnJlZ2lzdHJ5W25hbWVdID0gbmV3IE1vZHVsZSh2YWx1ZSwgdHlwZSk7XG4gIH1cblxuICByZXNvbHZlKFxuICAgIG5hbWU6IHN0cmluZyxcbiAgICByZWZlcnJlcjogVGVtcGxhdGVNZXRhPFdyYXBwZWRMb2NhdG9yPixcbiAgICBkZWZhdWx0Um9vdD86IHN0cmluZ1xuICApOiBPcHRpb248c3RyaW5nPiB7XG4gICAgbGV0IGxvY2FsID1cbiAgICAgIHJlZmVycmVyICYmXG4gICAgICByZWZlcnJlci5sb2NhdG9yLm1vZHVsZSAmJlxuICAgICAgcmVmZXJyZXIubG9jYXRvci5tb2R1bGUucmVwbGFjZSgvXigoLiopXFwvKT8oW15cXC9dKikkLywgYCQxJHtuYW1lfWApO1xuICAgIGlmIChsb2NhbCAmJiB0aGlzLnJlZ2lzdHJ5W2xvY2FsXSkge1xuICAgICAgcmV0dXJuIGxvY2FsO1xuICAgIH0gZWxzZSBpZiAoZGVmYXVsdFJvb3QgJiYgdGhpcy5yZWdpc3RyeVtgJHtkZWZhdWx0Um9vdH0vJHtuYW1lfWBdKSB7XG4gICAgICByZXR1cm4gYCR7ZGVmYXVsdFJvb3R9LyR7bmFtZX1gO1xuICAgIH0gZWxzZSBpZiAodGhpcy5yZWdpc3RyeVtuYW1lXSkge1xuICAgICAgcmV0dXJuIG5hbWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgdHlwZSBNb2R1bGVUeXBlID0gJ2NvbXBvbmVudCcgfCAnaGVscGVyJyB8ICdtb2RpZmllcicgfCAncGFydGlhbCcgfCAnb3RoZXInO1xuXG5leHBvcnQgY2xhc3MgTW9kdWxlIHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBkaWN0OiBEaWN0LCBwdWJsaWMgdHlwZTogTW9kdWxlVHlwZSkge1xuICAgIE9iamVjdC5mcmVlemUodGhpcy5kaWN0KTtcbiAgfVxuXG4gIGhhcyhrZXk6IHN0cmluZykge1xuICAgIHJldHVybiBrZXkgaW4gdGhpcy5kaWN0O1xuICB9XG5cbiAgZ2V0KGtleTogc3RyaW5nKTogdW5rbm93biB7XG4gICAgcmV0dXJuIHRoaXMuZGljdFtrZXldO1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2FwYWJpbGl0aWVzU3RhdGUge1xuICBjYXBhYmlsaXRpZXM6IENvbXBvbmVudENhcGFiaWxpdGllcztcbn1cblxuZXhwb3J0IGNsYXNzIEFvdENvbXBpbGVyUmVnaXN0cnkge1xuICBjb25zdHJ1Y3RvcihcbiAgICByZWFkb25seSBjb21wb25lbnRzOiBEaWN0PENvbXBvbmVudERlZmluaXRpb248VGVzdENvbXBvbmVudERlZmluaXRpb25TdGF0ZT4+ID0gZGljdCgpLFxuICAgIHJlYWRvbmx5IG1vZHVsZXM6IE1vZHVsZXMgPSBuZXcgTW9kdWxlcygpXG4gICkge31cblxuICByZWdpc3RlcihuYW1lOiBzdHJpbmcsIHR5cGU6IE1vZHVsZVR5cGUsIHZhbHVlOiBEaWN0PHVua25vd24+KSB7XG4gICAgdGhpcy5tb2R1bGVzLnJlZ2lzdGVyKG5hbWUsIHR5cGUsIHZhbHVlKTtcbiAgfVxuXG4gIGFkZENvbXBvbmVudChuYW1lOiBzdHJpbmcsIG1hbmFnZXI6IENvbXBvbmVudE1hbmFnZXIsIHN0YXRlOiBUZXN0Q29tcG9uZW50RGVmaW5pdGlvblN0YXRlKSB7XG4gICAgdGhpcy5jb21wb25lbnRzW25hbWVdID0geyBtYW5hZ2VyLCBzdGF0ZSB9O1xuICB9XG5cbiAgcmVzb2x2ZShcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgcmVmZXJyZXI6IFRlbXBsYXRlTWV0YTxXcmFwcGVkTG9jYXRvcj4sXG4gICAgeyBleHBlY3RlZCwgcm9vdCB9OiB7IGV4cGVjdGVkPzogTW9kdWxlVHlwZTsgcm9vdD86IHN0cmluZyB9ID0ge31cbiAgKTogT3B0aW9uPHN0cmluZz4ge1xuICAgIGxldCBtb2R1bGVOYW1lID0gdGhpcy5tb2R1bGVzLnJlc29sdmUobmFtZSwgcmVmZXJyZXIsIHJvb3QpO1xuICAgIGlmIChtb2R1bGVOYW1lID09PSBudWxsKSByZXR1cm4gbnVsbDtcblxuICAgIGxldCB0eXBlID0gdGhpcy5tb2R1bGVzLnR5cGUobW9kdWxlTmFtZSk7XG5cbiAgICBpZiAoZXhwZWN0ZWQgPT09IHVuZGVmaW5lZCB8fCB0eXBlID09PSBleHBlY3RlZCkge1xuICAgICAgcmV0dXJuIG1vZHVsZU5hbWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIGdldChuYW1lOiBzdHJpbmcpOiBNb2R1bGUge1xuICAgIHJldHVybiB0aGlzLm1vZHVsZXMuZ2V0KG5hbWUpO1xuICB9XG5cbiAgdHlwZShuYW1lOiBzdHJpbmcpOiBNb2R1bGVUeXBlIHtcbiAgICByZXR1cm4gdGhpcy5tb2R1bGVzLnR5cGUobmFtZSk7XG4gIH1cblxuICBnZXRDb21wb25lbnRDYXBhYmlsaXRpZXMobWV0YTogVGVtcGxhdGVNZXRhPFdyYXBwZWRMb2NhdG9yPik6IENvbXBvbmVudENhcGFiaWxpdGllcyB7XG4gICAgcmV0dXJuIHRoaXMuY29tcG9uZW50c1ttZXRhLmxvY2F0b3IubW9kdWxlXS5zdGF0ZS5jYXBhYmlsaXRpZXM7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRWFnZXJDb21waWxlckRlbGVnYXRlIGltcGxlbWVudHMgQ29tcGlsZXJEZWxlZ2F0ZTxXcmFwcGVkTG9jYXRvcj4ge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlZ2lzdHJ5OiBBb3RDb21waWxlclJlZ2lzdHJ5KSB7fVxuXG4gIGhhc0NvbXBvbmVudEluU2NvcGUoY29tcG9uZW50TmFtZTogc3RyaW5nLCByZWZlcnJlcjogVGVtcGxhdGVNZXRhPFdyYXBwZWRMb2NhdG9yPik6IGJvb2xlYW4ge1xuICAgIGxldCBuYW1lID0gdGhpcy5yZWdpc3RyeS5yZXNvbHZlKGNvbXBvbmVudE5hbWUsIHJlZmVycmVyLCB7XG4gICAgICByb290OiAndWkvY29tcG9uZW50cycsXG4gICAgICBleHBlY3RlZDogJ2NvbXBvbmVudCcsXG4gICAgfSk7XG4gICAgcmV0dXJuICEhbmFtZTtcbiAgfVxuXG4gIHJlc29sdmVDb21wb25lbnQoY29tcG9uZW50TmFtZTogc3RyaW5nLCByZWZlcnJlcjogVGVtcGxhdGVNZXRhPFdyYXBwZWRMb2NhdG9yPik6IE1vZHVsZUxvY2F0b3Ige1xuICAgIHJldHVybiB7XG4gICAgICBtb2R1bGU6IHRoaXMucmVnaXN0cnkucmVzb2x2ZShjb21wb25lbnROYW1lLCByZWZlcnJlciwgeyByb290OiAndWkvY29tcG9uZW50cycgfSkhLFxuICAgICAgbmFtZTogJ2RlZmF1bHQnLFxuICAgIH07XG4gIH1cblxuICBnZXRDb21wb25lbnRDYXBhYmlsaXRpZXMobWV0YTogVGVtcGxhdGVNZXRhPFdyYXBwZWRMb2NhdG9yPik6IENvbXBvbmVudENhcGFiaWxpdGllcyB7XG4gICAgcmV0dXJuIHRoaXMucmVnaXN0cnkuZ2V0Q29tcG9uZW50Q2FwYWJpbGl0aWVzKG1ldGEpO1xuICB9XG5cbiAgaGFzSGVscGVySW5TY29wZShoZWxwZXJOYW1lOiBzdHJpbmcsIHJlZmVycmVyOiBUZW1wbGF0ZU1ldGE8V3JhcHBlZExvY2F0b3I+KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICEhdGhpcy5yZWdpc3RyeS5yZXNvbHZlKGhlbHBlck5hbWUsIHJlZmVycmVyLCB7IGV4cGVjdGVkOiAnaGVscGVyJyB9KTtcbiAgfVxuXG4gIHJlc29sdmVIZWxwZXIoaGVscGVyTmFtZTogc3RyaW5nLCByZWZlcnJlcjogVGVtcGxhdGVNZXRhPFdyYXBwZWRMb2NhdG9yPik6IE1vZHVsZUxvY2F0b3Ige1xuICAgIHJldHVybiB7IG1vZHVsZTogdGhpcy5yZWdpc3RyeS5yZXNvbHZlKGhlbHBlck5hbWUsIHJlZmVycmVyKSEsIG5hbWU6ICdkZWZhdWx0JyB9O1xuICB9XG5cbiAgaGFzTW9kaWZpZXJJblNjb3BlKG1vZGlmaWVyTmFtZTogc3RyaW5nLCByZWZlcnJlcjogVGVtcGxhdGVNZXRhPFdyYXBwZWRMb2NhdG9yPik6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhIXRoaXMucmVnaXN0cnkucmVzb2x2ZShtb2RpZmllck5hbWUsIHJlZmVycmVyLCB7IGV4cGVjdGVkOiAnbW9kaWZpZXInIH0pO1xuICB9XG5cbiAgcmVzb2x2ZU1vZGlmaWVyKG1vZGlmaWVyTmFtZTogc3RyaW5nLCByZWZlcnJlcjogVGVtcGxhdGVNZXRhPFdyYXBwZWRMb2NhdG9yPik6IE1vZHVsZUxvY2F0b3Ige1xuICAgIHJldHVybiB7XG4gICAgICBtb2R1bGU6IHRoaXMucmVnaXN0cnkucmVzb2x2ZShtb2RpZmllck5hbWUsIHJlZmVycmVyLCB7IHJvb3Q6ICd1aS9jb21wb25lbnRzJyB9KSEsXG4gICAgICBuYW1lOiAnZGVmYXVsdCcsXG4gICAgfTtcbiAgfVxuXG4gIGhhc1BhcnRpYWxJblNjb3BlKF9wYXJ0aWFsTmFtZTogc3RyaW5nLCBfcmVmZXJyZXI6IFRlbXBsYXRlTWV0YTxXcmFwcGVkTG9jYXRvcj4pOiBib29sZWFuIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICByZXNvbHZlUGFydGlhbChfcGFydGlhbE5hbWU6IHN0cmluZywgX3JlZmVycmVyOiBUZW1wbGF0ZU1ldGE8V3JhcHBlZExvY2F0b3I+KTogTW9kdWxlTG9jYXRvciB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdNZXRob2Qgbm90IGltcGxlbWVudGVkLicpO1xuICB9XG59XG4iXX0=